<div class="details-header">
  <div class="grid-container">
    <h1>HSES Issue #<%= @complaint.id %></h1>
  </div>
</div>
<div class="details-body grid-container">
  <div class="grid-row grid-gap">

    <%# SUMMARY %>

    <div class="grid-col-4">
      <div class="summary-section">
        <div class="ct-section-divider">
          <h2>Summary</h2>
          <p>
            <strong><%= @complaint.grantee %>:</strong>
            <%= @complaint.summary %>
          </p>
        </div>

        <% if @issue_tta_reports.present? %>
          <div>
            <h3>TTA Activity:</h3>
            <div>
              <%= render partial: "issue_tta_report", collection: @issue_tta_reports %>
            </div>
          </div>
        <% end %>

        <% if @issue_monitoring_reviews.present? %>
          <div>
            <h3>RAN activity:</h3>
            <div>
              <%= render partial: "issue_monitoring_review", collection: @issue_monitoring_reviews %>
            </div>
          </div>
        <% end %>

        <%= render "tta_create_activity_report" %>
        <%= render "monitoring_create_review" %>

        <%= render partial: "complaints_open_new_linked_item",
          locals: {
            label: "Link TTA Activity Report",
            type: "tta-report" }
          %>
        <%= render partial: "complaints_open_new_linked_item",
          locals: {
            label: "Link RAN Review",
            type: "monitoring-review" }
        %>
      </div>
    </div>

    <%# STATUS AND TIMELINE %>

    <div class="grid-col-8">
      <div class="summary-section">
        <h2 class="ct-section-divider ct-timeline__two-part-container">
          <%= status(@complaint.attributes) %>
          <span class="ct-timeline__date">
            <% if !@complaint.due_date? %>
              No Due Date
            <% else %>
                <%= sanitize @complaint.relative_due_date_html %>
            <% end %>
          </span>
        </h2>
        <ul class="usa-process-list">
          <% @timeline.events.each do |event| %>
            <li class="usa-process-list__item usa-process-list__item-disc">
              <%= render partial: event.timeline_partial, locals: {event: event} %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>

<%# MODAL %>

<div class="margin-y-3">
  <div
    class="usa-modal"
    id="unlink-modal"
    aria-labelledby="unlink-modal-heading"
    aria-describedby="unlink-modal-description"
  >
    <div class="usa-modal__content">
      <div class="usa-modal__main">
        <h2 class="usa-modal__heading" id="unlink-modal-heading">
          Are you sure you want to unlink this TTA activity report?
        </h2>
        <div class="usa-prose">
          <p id="unlink-modal-description">
            This will remove the report from this complaint, but will not delete the report from TTA Hub
          </p>
        </div>
        <div class="usa-modal__footer">
          <ul class="usa-button-group">
            <li class="usa-button-group__item">
            <%= form_with url: unlink_tta_report_path(@complaint.id), method: "delete" do %>
              <%= hidden_field_tag :tta_report_display_id, nil, id: "hidden-tta-display_id" %>
              <%= submit_tag "Yes, remove the link", class: "usa-button" %>
            <% end %>
            </li>
            <li class="usa-button-group__item">
              <button
                type="button"
                class="usa-button usa-button--unstyled padding-105 text-center ct-close-modal"
                data-close-modal
              >
                Go back
              </button>
            </li>
          </ul>
        </div>
      </div>
      <button
        class="usa-button usa-modal__close ct-close-modal"
        aria-label="Close this window"
        data-close-modal
      >
        <%= image_pack_tag "media/usa-icons/close.svg", class: "usa-icon", "aria-hidden": true, focusable: false %>
      </button>
    </div>
  </div>
</div>
<%= javascript_pack_tag 'complaint-links' %>
